pipeline{
    agent{ label 'build' }
    stages{
        stage('Code Checkout'){
            steps{
                git branch: 'main', credentialsId: 'GithubCred', url: 'https://github.com/Mshahwaz/springboot-build-pipeline.git'
            }
        }
        stage('Stage I: Build'){
            steps{
                echo "Building Jar Component ..."
                sh "export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64; mvn clean package "
            }
        }
        stage('Stage II: Code Coverage ') {
            steps {
	            echo "Running Code Coverage ..."
                sh "export JAVA_HOME=/usr/lib/jvm/java-8-openjdk-amd64; mvn jacoco:report"
      }
    }
        stage('Stage III: SCA') {
            steps { 
                echo "Running Software Composition Analysis using OWASP Dependency-Check ..."
                 withCredentials([string(credentialsId: 'NVD_API_KEY', variable: 'NVD_API_KEY')]) {
                sh "export JAVA_HOME=/usr/lib/jvm/java-11-openjdk-amd64; mvn org.owasp:dependency-check-maven:check"
            
            }
      }
    }
    }
}